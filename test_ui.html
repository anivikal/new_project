<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battery Smart Voicebot - Voice Call Test</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .header h1 {
            font-size: 1.8rem;
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }
        
        .header p { color: #888; font-size: 0.9rem; }
        
        /* Phone UI */
        .phone-frame {
            background: #1e1e3f;
            border-radius: 30px;
            padding: 20px;
            border: 3px solid #333;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: #151530;
            border-radius: 15px;
            margin-bottom: 15px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff4444;
            transition: all 0.3s;
        }
        
        .status-dot.connected {
            background: #00ff88;
            box-shadow: 0 0 15px #00ff88;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 15px #00ff88; }
            50% { box-shadow: 0 0 25px #00ff88; }
        }
        
        .status-text { font-size: 0.9rem; }
        .call-duration { color: #00d4ff; font-weight: bold; font-size: 1.1rem; }
        
        /* Chat */
        .chat-container {
            background: #151530;
            border-radius: 20px;
            height: 350px;
            overflow-y: auto;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            margin-bottom: 12px;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.bot {
            background: linear-gradient(135deg, #2a2a4a, #3a3a5a);
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }
        
        .message.bot.speaking {
            border: 2px solid #00d4ff;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }
        
        .message.user {
            background: linear-gradient(135deg, #0066ff, #0088ff);
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        
        .message.system {
            background: rgba(100, 100, 255, 0.15);
            color: #aaaaff;
            margin: 10px auto;
            text-align: center;
            font-size: 0.85rem;
        }
        
        .message.handoff {
            background: linear-gradient(135deg, rgba(255, 68, 68, 0.2), rgba(255, 100, 100, 0.2));
            color: #ff8888;
            margin: 15px auto;
            text-align: center;
            border: 2px solid #ff6666;
        }
        
        .message-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
            font-size: 0.7rem;
        }
        
        .meta-badge {
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .meta-badge.intent { background: rgba(0, 212, 255, 0.2); color: #00d4ff; }
        .meta-badge.sentiment.positive { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
        .meta-badge.sentiment.neutral { background: rgba(150, 150, 150, 0.2); color: #aaa; }
        .meta-badge.sentiment.negative { background: rgba(255, 100, 100, 0.2); color: #ff6666; }
        .meta-badge.lang { background: rgba(255, 200, 0, 0.2); color: #ffc800; }
        
        /* Voice Wave Animation */
        .voice-wave {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 4px;
            height: 40px;
            margin: 15px 0;
        }
        
        .voice-wave .bar {
            width: 4px;
            background: #00d4ff;
            border-radius: 2px;
            animation: none;
        }
        
        .voice-wave.active .bar {
            animation: wave 0.6s ease-in-out infinite;
        }
        
        .voice-wave .bar:nth-child(1) { animation-delay: 0s; height: 15px; }
        .voice-wave .bar:nth-child(2) { animation-delay: 0.1s; height: 25px; }
        .voice-wave .bar:nth-child(3) { animation-delay: 0.2s; height: 35px; }
        .voice-wave .bar:nth-child(4) { animation-delay: 0.3s; height: 25px; }
        .voice-wave .bar:nth-child(5) { animation-delay: 0.4s; height: 15px; }
        
        @keyframes wave {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1.5); }
        }
        
        .voice-wave.listening .bar { background: #ff6666; }
        .voice-wave.speaking .bar { background: #00ff88; }
        
        /* Controls */
        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .mic-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        
        .mic-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #0066ff, #00d4ff);
            color: white;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(0, 102, 255, 0.4);
        }
        
        .mic-btn:hover:not(:disabled) { transform: scale(1.1); }
        
        .mic-btn.listening {
            background: linear-gradient(135deg, #ff4444, #ff6666);
            animation: micPulse 1s infinite;
        }
        
        .mic-btn:disabled {
            background: #444;
            box-shadow: none;
            cursor: not-allowed;
        }
        
        @keyframes micPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .voice-hint {
            text-align: center;
            color: #888;
            font-size: 0.85rem;
            min-height: 25px;
        }
        
        .voice-hint.listening { color: #ff6666; }
        .voice-hint.speaking { color: #00ff88; }
        
        .text-row {
            display: flex;
            gap: 10px;
        }
        
        .text-row input {
            flex: 1;
            padding: 14px 18px;
            border: 2px solid #333;
            border-radius: 25px;
            background: #151530;
            color: white;
            font-size: 1rem;
            outline: none;
        }
        
        .text-row input:focus { border-color: #00d4ff; }
        .text-row input:disabled { opacity: 0.5; }
        
        .text-row button {
            padding: 14px 25px;
            background: linear-gradient(135deg, #00ff88, #00d4ff);
            border: none;
            border-radius: 25px;
            color: #1a1a2e;
            font-weight: bold;
            cursor: pointer;
        }
        
        .text-row button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .call-btns {
            display: flex;
            gap: 10px;
        }
        
        .call-btns button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
        }
        
        .call-btns .start-btn {
            background: linear-gradient(135deg, #00ff88, #00d4ff);
            color: #1a1a2e;
        }
        
        .call-btns .end-btn {
            background: linear-gradient(135deg, #ff4444, #ff6666);
            color: white;
        }
        
        .call-btns button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* Quick buttons */
        .quick-btns {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 15px;
        }
        
        .quick-btn {
            padding: 10px;
            background: #2a2a4a;
            border: 1px solid #333;
            border-radius: 10px;
            color: #fff;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quick-btn:hover:not(:disabled) {
            background: #3a3a5a;
            border-color: #00d4ff;
        }
        
        .quick-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* Language selector */
        .lang-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }
        
        .lang-btn {
            padding: 8px 20px;
            background: #2a2a4a;
            border: 2px solid #333;
            border-radius: 20px;
            color: #fff;
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        .lang-btn.active {
            background: linear-gradient(135deg, #0066ff, #00d4ff);
            border-color: #00d4ff;
        }
        
        /* Audio indicator */
        .audio-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1e1e3f;
            padding: 15px 20px;
            border-radius: 15px;
            border: 2px solid #00d4ff;
            display: none;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .audio-indicator.visible { display: flex; }
        
        .audio-indicator .icon {
            font-size: 1.5rem;
            animation: speakPulse 0.5s infinite;
        }
        
        @keyframes speakPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîã Battery Smart Voicebot</h1>
            <p>Talk naturally in Hindi, English or Hinglish</p>
        </div>
        
        <div class="phone-frame">
            <div class="status-bar">
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span class="status-text" id="statusText">Tap Start Call</span>
                </div>
                <div class="call-duration" id="callDuration">00:00</div>
            </div>
            
            <!-- Language selector -->
            <div class="lang-selector">
                <button class="lang-btn active" onclick="setLanguage('hi')" id="langHi">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
                <button class="lang-btn" onclick="setLanguage('hi-en')" id="langHiEn">Hinglish</button>
                <button class="lang-btn" onclick="setLanguage('en')" id="langEn">English</button>
            </div>
            
            <div class="chat-container" id="chatMessages">
                <div class="message system">
                    üëã Welcome! Click "Start Call" to begin. Speak in your preferred language.
                </div>
            </div>
            
            <div class="voice-wave" id="voiceWave">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            
            <div class="controls">
                <div class="voice-hint" id="voiceHint">Click microphone to speak</div>
                
                <div class="mic-container">
                    <button class="mic-btn" id="micBtn" onclick="toggleMic()" disabled>üé§</button>
                </div>
                
                <div class="text-row">
                    <input type="text" id="messageInput" placeholder="Or type your message..." disabled>
                    <button id="sendBtn" onclick="sendTextMessage()" disabled>Send</button>
                </div>
                
                <div class="call-btns">
                    <button class="start-btn" id="startBtn" onclick="startCall()">üìû Start Call</button>
                    <button class="end-btn" id="endBtn" onclick="endCall()" disabled>üì¥ End</button>
                </div>
            </div>
            
            <div class="quick-btns">
                <button class="quick-btn" onclick="sendQuick('‡§®‡§Æ‡§∏‡•ç‡§§‡•á')" disabled>üôè ‡§®‡§Æ‡§∏‡•ç‡§§‡•á</button>
                <button class="quick-btn" onclick="sendQuick('nearest station')" disabled>üìç Station</button>
                <button class="quick-btn" onclick="sendQuick('subscription status')" disabled>üí≥ Subscription</button>
                <button class="quick-btn" onclick="sendQuick('swap history')" disabled>üìã History</button>
            </div>
        </div>
    </div>
    
    <!-- Audio speaking indicator -->
    <div class="audio-indicator" id="audioIndicator">
        <span class="icon">üîä</span>
        <span>AI Speaking...</span>
    </div>

    <script>
        // State
        let callId = null;
        let isListening = false;
        let isSpeaking = false;
        let callStartTime = null;
        let callTimer = null;
        let recognition = null;
        let currentLanguage = 'hi'; // Default Hindi
        let audioQueue = [];
        let currentAudio = null;
        
        // Elements
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const startBtn = document.getElementById('startBtn');
        const endBtn = document.getElementById('endBtn');
        const micBtn = document.getElementById('micBtn');
        const voiceHint = document.getElementById('voiceHint');
        const voiceWave = document.getElementById('voiceWave');
        const callDuration = document.getElementById('callDuration');
        const audioIndicator = document.getElementById('audioIndicator');
        const quickBtns = document.querySelectorAll('.quick-btn');
        
        // API URL
        const API_URL = 'http://localhost:8000';
        
        // Language setting
        function setLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('lang' + (lang === 'hi' ? 'Hi' : lang === 'en' ? 'En' : 'HiEn')).classList.add('active');
            
            // Update speech recognition language
            if (recognition) {
                recognition.lang = lang === 'en' ? 'en-IN' : 'hi-IN';
            }
        }
        
        // Initialize Speech Recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
            } else if ('SpeechRecognition' in window) {
                recognition = new SpeechRecognition();
            } else {
                addMessage('‚ö†Ô∏è Speech recognition not supported. Please use Chrome.', 'system');
                return false;
            }
            
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = currentLanguage === 'en' ? 'en-IN' : 'hi-IN';
            
            recognition.onstart = () => {
                isListening = true;
                micBtn.classList.add('listening');
                micBtn.textContent = 'üî¥';
                voiceHint.textContent = 'üé§ Listening... speak now';
                voiceHint.className = 'voice-hint listening';
                voiceWave.classList.add('active', 'listening');
                voiceWave.classList.remove('speaking');
            };
            
            recognition.onresult = (event) => {
                let transcript = '';
                let isFinal = false;
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                    if (event.results[i].isFinal) isFinal = true;
                }
                
                voiceHint.textContent = 'üí¨ ' + transcript;
                
                if (isFinal && transcript.trim()) {
                    sendMessage(transcript.trim());
                }
            };
            
            recognition.onerror = (event) => {
                console.error('Speech error:', event.error);
                if (event.error === 'no-speech') {
                    voiceHint.textContent = 'üò∂ No speech detected. Try again.';
                } else if (event.error === 'not-allowed') {
                    voiceHint.textContent = 'üö´ Microphone blocked. Please allow access.';
                }
                stopListening();
            };
            
            recognition.onend = () => {
                stopListening();
            };
            
            return true;
        }
        
        function toggleMic() {
            if (!callId) return;
            
            // Stop any playing audio first
            stopAudio();
            
            if (isListening) {
                recognition.stop();
            } else {
                startListening();
            }
        }
        
        function startListening() {
            if (!recognition && !initSpeechRecognition()) return;
            
            stopAudio(); // Stop any playing audio
            
            try {
                recognition.start();
            } catch (e) {
                console.error('Recognition start error:', e);
            }
        }
        
        function stopListening() {
            isListening = false;
            micBtn.classList.remove('listening');
            micBtn.textContent = 'üé§';
            voiceWave.classList.remove('active', 'listening');
            
            setTimeout(() => {
                if (!isListening && !isSpeaking) {
                    voiceHint.textContent = 'Click microphone to speak';
                    voiceHint.className = 'voice-hint';
                }
            }, 2000);
        }
        
        // Audio playback
        function playAudio(base64Audio) {
            return new Promise((resolve, reject) => {
                if (!base64Audio) {
                    resolve();
                    return;
                }
                
                stopAudio(); // Stop any currently playing audio
                
                try {
                    currentAudio = new Audio('data:audio/mp3;base64,' + base64Audio);
                    
                    currentAudio.onplay = () => {
                        isSpeaking = true;
                        voiceHint.textContent = 'üîä AI is speaking...';
                        voiceHint.className = 'voice-hint speaking';
                        voiceWave.classList.add('active', 'speaking');
                        voiceWave.classList.remove('listening');
                        audioIndicator.classList.add('visible');
                        
                        // Highlight the last bot message
                        const lastBotMsg = document.querySelector('.message.bot:last-of-type');
                        if (lastBotMsg) lastBotMsg.classList.add('speaking');
                    };
                    
                    currentAudio.onended = () => {
                        isSpeaking = false;
                        voiceWave.classList.remove('active', 'speaking');
                        audioIndicator.classList.remove('visible');
                        voiceHint.textContent = 'Click microphone to speak';
                        voiceHint.className = 'voice-hint';
                        
                        // Remove highlight
                        document.querySelectorAll('.message.speaking').forEach(m => m.classList.remove('speaking'));
                        
                        resolve();
                    };
                    
                    currentAudio.onerror = (e) => {
                        console.error('Audio error:', e);
                        isSpeaking = false;
                        audioIndicator.classList.remove('visible');
                        reject(e);
                    };
                    
                    currentAudio.play().catch(e => {
                        console.error('Play failed:', e);
                        // Try with user interaction fallback
                        addMessage('üîá Click anywhere to enable audio', 'system');
                        reject(e);
                    });
                    
                } catch (e) {
                    console.error('Audio creation error:', e);
                    reject(e);
                }
            });
        }
        
        function stopAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            isSpeaking = false;
            audioIndicator.classList.remove('visible');
            voiceWave.classList.remove('active', 'speaking');
            document.querySelectorAll('.message.speaking').forEach(m => m.classList.remove('speaking'));
        }
        
        // API calls
        async function startCall() {
            try {
                statusText.textContent = 'Connecting...';
                
                const response = await fetch(`${API_URL}/api/v1/voice/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        phone_number: '9876543210',
                        language: currentLanguage
                    })
                });
                
                const data = await response.json();
                callId = data.call_id;
                
                // UI updates
                statusDot.classList.add('connected');
                statusText.textContent = 'Connected';
                startBtn.disabled = true;
                endBtn.disabled = false;
                micBtn.disabled = false;
                messageInput.disabled = false;
                sendBtn.disabled = false;
                quickBtns.forEach(btn => btn.disabled = false);
                
                // Start timer
                callStartTime = Date.now();
                callTimer = setInterval(updateDuration, 1000);
                
                // Clear and show greeting
                chatMessages.innerHTML = '';
                addMessage(data.greeting_text, 'bot', { intent: 'greeting', sentiment: 'positive', lang: currentLanguage });
                
                // Play greeting audio
                if (data.greeting_audio_base64) {
                    await playAudio(data.greeting_audio_base64);
                }
                
                // Initialize speech recognition
                initSpeechRecognition();
                
            } catch (error) {
                console.error('Start call error:', error);
                addMessage('‚ùå Failed to connect. Is the server running?', 'system');
            }
        }
        
        function endCall() {
            callId = null;
            
            if (callTimer) {
                clearInterval(callTimer);
                callTimer = null;
            }
            callDuration.textContent = '00:00';
            
            stopAudio();
            if (recognition) recognition.stop();
            
            statusDot.classList.remove('connected');
            statusText.textContent = 'Call Ended';
            startBtn.disabled = false;
            endBtn.disabled = true;
            micBtn.disabled = true;
            messageInput.disabled = true;
            sendBtn.disabled = true;
            quickBtns.forEach(btn => btn.disabled = true);
            
            addMessage('üì¥ Call ended', 'system');
        }
        
        function updateDuration() {
            if (!callStartTime) return;
            const elapsed = Math.floor((Date.now() - callStartTime) / 1000);
            const mins = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const secs = (elapsed % 60).toString().padStart(2, '0');
            callDuration.textContent = `${mins}:${secs}`;
        }
        
        async function sendMessage(text) {
            if (!callId || !text.trim()) return;
            
            addMessage(text, 'user');
            voiceHint.textContent = '‚è≥ Processing...';
            
            try {
                const response = await fetch(`${API_URL}/api/v1/voice/message`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        call_id: callId,
                        text: text,
                        language: currentLanguage
                    })
                });
                
                const data = await response.json();
                
                // Detect language from response or use detected
                const detectedLang = data.detected_language || currentLanguage;
                
                addMessage(data.response_text, 'bot', {
                    intent: data.intent,
                    sentiment: data.sentiment,
                    lang: detectedLang
                });
                
                // Play response audio
                if (data.response_audio_base64) {
                    await playAudio(data.response_audio_base64);
                }
                
                // Handle handoff
                if (data.handoff_triggered) {
                    addMessage('üö® Connecting to human agent...', 'handoff');
                }
                
            } catch (error) {
                console.error('Send error:', error);
                addMessage('‚ùå Error: ' + error.message, 'system');
            }
            
            voiceHint.textContent = 'Click microphone to speak';
            voiceHint.className = 'voice-hint';
        }
        
        function sendTextMessage() {
            const text = messageInput.value.trim();
            if (text) {
                sendMessage(text);
                messageInput.value = '';
            }
        }
        
        function sendQuick(text) {
            if (callId) sendMessage(text);
        }
        
        function addMessage(text, type, meta = {}) {
            const div = document.createElement('div');
            div.className = `message ${type}`;
            
            const content = document.createElement('div');
            content.textContent = text;
            div.appendChild(content);
            
            // Add meta badges for bot messages
            if (type === 'bot' && (meta.intent || meta.sentiment || meta.lang)) {
                const metaDiv = document.createElement('div');
                metaDiv.className = 'message-meta';
                
                if (meta.intent) {
                    const badge = document.createElement('span');
                    badge.className = 'meta-badge intent';
                    badge.textContent = 'üéØ ' + meta.intent;
                    metaDiv.appendChild(badge);
                }
                
                if (meta.sentiment) {
                    const badge = document.createElement('span');
                    let sentClass = 'neutral';
                    if (meta.sentiment === 'positive') sentClass = 'positive';
                    else if (['negative', 'frustrated'].includes(meta.sentiment)) sentClass = 'negative';
                    badge.className = 'meta-badge sentiment ' + sentClass;
                    badge.textContent = meta.sentiment === 'positive' ? 'üòä' : meta.sentiment === 'negative' ? 'üòû' : meta.sentiment === 'frustrated' ? 'üò§' : 'üòê';
                    metaDiv.appendChild(badge);
                }
                
                if (meta.lang) {
                    const badge = document.createElement('span');
                    badge.className = 'meta-badge lang';
                    badge.textContent = meta.lang === 'hi' ? 'üáÆüá≥ Hindi' : meta.lang === 'en' ? 'üá¨üáß English' : 'üáÆüá≥ Hinglish';
                    metaDiv.appendChild(badge);
                }
                
                div.appendChild(metaDiv);
            }
            
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Event listeners
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendTextMessage();
        });
        
        // Enable audio on first user interaction (for autoplay policy)
        document.addEventListener('click', () => {
            // Create a silent audio to unlock audio context
            const silentAudio = new Audio('data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAAYZNJmT0AAAAAAAAAAAAAAAAAAAAAP/7kGQAAANUMEoFPeACNQV40KEABIU8FtnhPG0EkVRzQEABBAMBAAKIBgYODADAIA/8CAEAwGBg4MAABgeD4PwfB8H4Ph+H4fgAAAAAAGLAAAAAADwf+D4Pwfh+H4fn/+D/8P/4YAAAAAAAAQgAAAAADAEAIAgBAA//tQZAAAAhQBSBUMAAIogCkCoYAABXgDIHwwAADCAGQPhgAAMABEAgGAwEAwGAg');
            silentAudio.play().catch(() => {});
        }, { once: true });
        
        // Check server on load
        fetch(`${API_URL}/health`)
            .then(r => r.json())
            .then(d => {
                if (d.status === 'healthy') {
                    statusText.textContent = 'Ready - Click Start';
                }
            })
            .catch(() => {
                statusText.textContent = 'Server offline';
            });
    </script>
</body>
</html>
